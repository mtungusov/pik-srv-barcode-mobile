<html>
<head>
    <script src="jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            var ws;

            function debug(str){ $("#debug").append("<p>"+str+"</p>"); };

            function connectToWebsocket() {
                if (!("WebSocket" in window)) {
                    alert("Your browser not compatibility with Websocket!");
                    return false;
                }

                var device_id = $('#device_id').val();

                // ws = new WebSocket("ws://localhost:3001/" + device_id);
                ws = new WebSocket("ws://localhost:3001/111");
                // ws = new WebSocket("ws://bm01dsk2.dsk2.picompany.ru/111");
                // ws = new WebSocket("ws://192.168.252.19/111");
                // ws = new WebSocket("ws://192.168.100.32/111");
                ws.onmessage = function(evt) {
                    $("#msg").append("<p>"+evt.data+"</p>");
                };
                ws.onclose = function() { debug("disconnected..."); };
                ws.onopen = function() {
                    debug("connected...");
                };
                window.ws = ws;
                return false;
            };

            function sendToWebsocket() {
                var from = $('#device_id').val();
                var method = $('#method').val();
                var params = {};
                params['topic'] = $('input[name="params_p1"]').val();
                params['offset'] = $('input[name="params_p2"]').val();
                var id = $('#id').val();

                var msg = {
                    "jsonrpc": "2.0",
                    "method": method,
                    "params": params,
                    "id": id
                };

                debug(JSON.stringify(msg));
                ws.send(JSON.stringify(msg));
                return false;
            };

            $("#connect").submit(connectToWebsocket);
            $("#send").submit(sendToWebsocket);

        });
    </script>
    <style>
        body {
            font-family: "Menlo";
        }
        #debug {
            color: red;
            font-size: small;
        }
        #msg {
            color: green;
            font-size: x-small;
        }
    </style>
</head>
<body>
<form id="connect" action="" data-remote="true">
    <label for="device_id">Device Id:</label>
    <input type="text" id="device_id" value="111">
    <input type="submit" value="Connect">
</form>
<div id="msg"></div>
<form id="send" action="">
    <label for="method">Method:</label><br>
    <input type="text" id="method"><br>

    <label>Params:</label><br>
    <label>topic:</label><br>
    <input type="text" name="params_p1"><br>
    <label>offset:</label><br>
    <input type="text" name="params_p2"><br>

    <label for="id">Id:</label><br>
    <input type="text" id="id"><br>
    <input type="submit" value="Send">
</form>
<div id="debug"></div>
</body>
</html>
